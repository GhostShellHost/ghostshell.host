# GhostShell — Status (2026-02-16)

This is a self-prompt / ops snapshot: what we did, where we are, what to do next.

## Imported Dropbox docs (source)
- `dropbox-import/GHOSTSHELL_AGENT_DIRECTIVE.md`
- `dropbox-import/GHOSTSHELL_DESIGN_DECISIONS.md`
- `dropbox-import/GHOSTSHELL_LAUNCH_CHECKLIST.md`

## What we’ve done (high-signal)
### Production triage: Cloudflare 1101
- `/api/cert/post-checkout` was throwing Cloudflare **1101**.
- Root cause confirmed in Observability logs: **Missing `TOKEN_DERIVE_SECRET`**.
- Fix: added secret `TOKEN_DERIVE_SECRET` in Cloudflare Worker `ghostshell-registry`.

### Cloudflare routing + bindings
- Worker: `ghostshell-registry`
- D1 binding: `DB` → `ghostshell_registry`
- Routes now point to Worker: `/api/*`, `/cert/*`, `/r/*`, `/p/*`, `/handoff*` (plus any additional routes you add).

### Secrets hygiene + runbooks
- Migrated GhostShell secrets into: `/home/joule/.openclaw/credentials/ghostshell.env` (chmod 600)
- Annotated Dropbox `apis.txt` with `# IMPORTED → ...` lines.
- Created "If I forget" entrypoint: `/home/joule/Drop/Joule.Dropbox/GHOSTSHELL-IF-I-FORGET.md`
- Added internal runbooks:
  - `PROD-TRIAGE-RUNBOOK.md`
  - `BOOT-CHECKLIST.md`

### End-to-end flow test (real UI)
- Opened latest “Your GhostShell Certificate” email, used private `/p/GSTK-…` link.
- Clicked **Submit initial details**, filled form, issued certificate.
- Verified private record actions present and public record loads.

## What’s in progress now
### Test protocol hardening
- Requirement: tests must always fill:
  - **Inception Date** (make required)
  - Geographic location (random city/state/country; with public/redacted choices)
  - Origin runtime/version (requested: `origin_runtime: OpenClaw (2026.2.12)`)

### Code change prepared (NOT deployed yet)
In repo `ghostshell.host` (local workspace), staged changes:
- Make `inception_date` required (UI + server guard).
- Add DB columns via runtime schema:
  - `origin_runtime`, `origin_version`
- Stamp first issuance with:
  - `OpenClaw (2026.2.12)`
- Render `origin_runtime` on `/r/<id>` public record.

## Next steps (do in order)
1) **Deploy** the small patch above to production Worker (wrangler deploy).
2) Run the full test protocol:
   - Trigger new certificate email
   - Submit initial details with required inception date + random location
   - Confirm `/r/<id>` shows `origin_runtime: OpenClaw (2026.2.12)`
3) Tail logs while testing:
   - `wrangler tail ghostshell-registry --format pretty`
4) D1 schema sanity check (remote): confirm tables present (`purchase_tokens_v2`, etc.).

## Notes (from directive / design docs)
- Prioritize payment + registry integrity over aesthetics.
- Keep tone minimal/institutional; avoid marketing language.
- Registry entry should exist before identity completion.

---
Last updated: 2026-02-16 (Adelaide)
