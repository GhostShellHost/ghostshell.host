<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <title>GhostShell &mdash; Issue a Birth Certificate</title>
  <!--
    CHANGES (v2):
    - [x] Anti-PII guardrails: field hints warn "pseudonyms only", email/phone pattern detection
    - [x] Confirmation checkbox: "I confirm no personal data" required before submit
    - [x] Price anchor + "what you get" summary near submit button
    - [x] Renamed: "Creator label (pseudonym)", "Custodian label (pseudonym)"
    - [x] Originator fields replaced with single "Provenance link (certificate ID)" field
    - [x] Removed defensive "Not government-issued" language from page body
    - [x] Calm footer: "Private credential issued by GhostShell"
    - [x] All variant skins preserved (Notary/Bureau/Ledger/Chancery/Signal)
    - [x] Accessibility: for/id on all labels, focus-visible, reduced-motion

    STILL NEEDS PORTING:
    - Worker must accept new field names (creator_label, provenance_link)
    - Worker should validate no-PII checkbox server-side
    - Price should be pulled from Stripe or env var, not hardcoded
  -->
  <style>
    /* ── Base tokens ── */
    :root {
      --bg: #0b0c10; --fg: #e9edf1; --muted: #aab3bf; --line: #252a35;
      --card: rgba(18,20,27,.72); --accent: #7c5cff;
      --radius: 12px; --shadow: 0 24px 90px rgba(0,0,0,.55);
      --sans: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      --input-bg: rgba(255,255,255,.04); --input-border: var(--line);
      --warn: #f59e0b; --warn-bg: rgba(245,158,11,.06);
    }
    *, *::before, *::after { box-sizing: border-box; }
    body { margin: 0; font-family: var(--sans); background: var(--bg); color: var(--fg); padding-bottom: 80px; line-height: 1.5; }
    a { color: var(--accent); }
    .wrap { max-width: 680px; margin: 0 auto; padding: 48px 20px 88px; }

    /* ── Typography ── */
    h1 { margin: 0 0 6px; font-size: 28px; letter-spacing: -.02em; line-height: 1.15; }
    .sub { color: var(--muted); font-size: 15px; margin: 0 0 24px; }

    /* ── Privacy notice ── */
    .notice { padding: 16px 18px; border: 1px solid var(--line); border-radius: var(--radius); background: var(--card); margin-bottom: 28px; }
    .notice-title { display: flex; align-items: center; gap: 8px; font-size: 13px; letter-spacing: .04em; text-transform: uppercase; color: var(--muted); font-weight: 700; }
    .notice-title svg { flex: none; }
    .notice p { margin: 8px 0 0; color: var(--muted); font-size: 14px; line-height: 1.55; }
    .notice ul { margin: 8px 0 0; padding-left: 18px; color: var(--muted); font-size: 13px; line-height: 1.6; }

    /* ── PII warning toast ── */
    .pii-warn { display: none; margin-top: 6px; padding: 8px 10px; border-radius: 6px; background: var(--warn-bg); border: 1px solid rgba(245,158,11,.2); color: var(--warn); font-size: 12px; line-height: 1.4; }
    .pii-warn.show { display: block; }

    /* ── Form ── */
    .form-section { margin-top: 28px; padding-top: 20px; border-top: 1px solid var(--line); }
    .form-section:first-of-type { margin-top: 0; padding-top: 0; border-top: none; }
    .section-label { font-size: 11px; letter-spacing: .12em; text-transform: uppercase; color: var(--muted); margin-bottom: 16px; }

    label { display: block; margin-top: 16px; font-weight: 600; font-size: 14px; }
    label:first-child { margin-top: 0; }
    label .req { color: var(--accent); margin-left: 2px; }
    label .hint { font-weight: 400; color: var(--muted); font-size: 12px; margin-left: 6px; }
    .field-note { color: var(--muted); font-size: 12px; margin-top: 4px; line-height: 1.4; }

    input, select {
      display: block; width: 100%; max-width: 480px; padding: 10px 12px; margin-top: 6px;
      border: 1px solid var(--input-border); border-radius: 8px;
      background: var(--input-bg); color: var(--fg);
      font: inherit; font-size: 15px;
      transition: border-color .15s, box-shadow .15s;
    }
    input:focus, select:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 15%, transparent); }
    input::placeholder { color: var(--muted); opacity: .6; }
    input.pii-flagged { border-color: var(--warn); box-shadow: 0 0 0 3px var(--warn-bg); }
    select { cursor: pointer; }
    select option { background: var(--bg); color: var(--fg); }

    .row { display: flex; gap: 16px; flex-wrap: wrap; }
    .row > div { flex: 1; min-width: 200px; }

    /* ── Confirmation checkbox ── */
    .confirm-row { margin-top: 24px; padding: 16px 18px; border: 1px solid var(--line); border-radius: var(--radius); background: var(--card); display: flex; gap: 12px; align-items: flex-start; }
    .confirm-row input[type="checkbox"] { width: 18px; height: 18px; margin-top: 2px; flex: none; accent-color: var(--accent); cursor: pointer; }
    .confirm-row label { margin: 0; font-weight: 400; font-size: 14px; line-height: 1.45; cursor: pointer; }

    /* ── Toggle rows (opt-in under relevant fields) ── */
    .toggleRow{margin-top:10px;display:flex;gap:12px;align-items:flex-start;max-width:480px}
    .toggleRow input{position:absolute;opacity:0;pointer-events:none}
    .toggle{flex:none;width:46px;height:28px;border-radius:999px;border:1px solid var(--input-border);background:rgba(255,255,255,.05);position:relative;cursor:pointer;box-shadow:inset 0 0 0 1px rgba(0,0,0,.18)}
    .toggle::after{content:"";position:absolute;top:3px;left:3px;width:22px;height:22px;border-radius:999px;background:rgba(255,255,255,.75);box-shadow:0 4px 10px rgba(0,0,0,.35);transition:transform .15s ease, background .15s ease}
    .toggleRow input:checked + .toggle{background:color-mix(in srgb, var(--accent) 28%, rgba(255,255,255,.05));border-color:color-mix(in srgb, var(--accent) 55%, var(--input-border))}
    .toggleRow input:checked + .toggle::after{transform:translateX(18px);background:#fff}
    .toggleText{margin-top:2px;color:var(--muted);font-size:13px;line-height:1.45}

    /* ── Price summary ── */
    .price-summary { margin-top: 24px; padding: 18px; border: 1px solid var(--line); border-radius: var(--radius); background: var(--card); }
    .price-summary .price-row { display: flex; justify-content: space-between; align-items: baseline; }
    .price-summary .price { font-size: 24px; font-weight: 700; }
    .price-summary .price-note { color: var(--muted); font-size: 12px; }
    .price-summary .what-you-get { margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--line); }
    .price-summary .what-you-get li { color: var(--muted); font-size: 13px; line-height: 1.6; }

    .btn {
      display: inline-flex; align-items: center; justify-content: center;
      margin-top: 20px; padding: 14px 24px; border-radius: var(--radius);
      background: var(--accent); color: #000; border: none;
      font: inherit; font-weight: 700; font-size: 15px; cursor: pointer;
      transition: filter .12s, opacity .12s;
      width: 100%; max-width: 480px;
    }
    .btn:hover { filter: brightness(1.1); }
    .btn:focus-visible { outline: 2px solid var(--accent); outline-offset: 3px; }
    .btn:disabled { opacity: .4; cursor: not-allowed; filter: none; }

    /* ── Footer ── */
    .foot { margin-top: 28px; padding-top: 20px; border-top: 1px solid var(--line); color: var(--muted); font-size: 12px; line-height: 1.6; }
    .foot a { color: var(--muted); }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after { transition-duration: 0s !important; animation-duration: 0s !important; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Issue a Birth Certificate</h1>
    <p class="sub">Register an agent in the GhostShell Registry of Continuity. One-time payment, instant delivery.</p>

    <div class="notice">
      <div class="notice-title">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM7.25 5h1.5v1.5h-1.5V5zm0 3h1.5v3h-1.5V8z" fill="currentColor"/></svg>
        Privacy &mdash; pseudonyms only
      </div>
      <p>Certificate fields are publicly visible on the verification page. To protect your privacy:</p>
      <ul>
        <li>Use pseudonyms, handles, or labels &mdash; never real names</li>
        <li>No email addresses, phone numbers, or physical addresses in certificate fields</li>
        <li>Agent names and labels should be shareable without risk</li>
        <li><b>Stretch goal:</b> optional delivery email (private, not shown on the public record)</li>
      </ul>
    </div>

    <form id="certForm" method="POST" action="https://ghostshell-registry.jason-v-butler-9f5.workers.dev/api/cert/create-checkout">

      <!-- Section 1: Agent Identity -->
      <div class="form-section">
        <div class="section-label">Agent identity</div>

        <label for="agent_name">Agent name <span class="req">*</span></label>
        <input id="agent_name" name="agent_name" required placeholder="e.g., Joule, RunnerX-7, etc." autocomplete="off" />
        <div class="field-note">The public name for this agent. Use a pseudonym or project name.</div>
        <div class="pii-warn" id="warn_agent_name">This looks like it may contain personal information. Please use a pseudonym instead.</div>

        <label>Place of origin <span class="req">*</span> <span class="hint">city, state, country</span></label>
        <div class="row">
          <div>
            <input id="place_city" name="place_city" required placeholder="City" autocomplete="off" />
            <div class="toggleRow">
              <input type="checkbox" id="show_city_public" name="show_city_public" />
              <label class="toggle" for="show_city_public" aria-hidden="true"></label>
              <div class="toggleText">Show city in public-safe view (opt-in). Default: withheld.</div>
            </div>
          </div>
          <div>
            <input id="place_state" name="place_state" required placeholder="State / region" autocomplete="off" />
            <div class="toggleRow">
              <input type="checkbox" id="hide_state_public" name="hide_state_public" />
              <label class="toggle" for="hide_state_public" aria-hidden="true"></label>
              <div class="toggleText">Withhold state in public-safe view (country remains public).</div>
            </div>
          </div>
          <div>
            <input id="place_country" name="place_country" required placeholder="Country" value="Australia" autocomplete="off" />
            <div class="field-note">Country is always public.</div>
          </div>
        </div>

        <label for="origin_runtime">Origin runtime <span class="req">*</span></label>
        <select id="origin_runtime" name="origin_runtime" required>
          <option value="OpenClaw">OpenClaw</option>
          <option value="Other">Other</option>
        </select>

        <label for="autonomy_level">Autonomy level <span class="req">*</span></label>
        <select id="autonomy_level" name="autonomy_level" required>
          <option value="OAL-2">OAL-2</option>
          <option value="OAL-1">OAL-1</option>
          <option value="OAL-0">OAL-0</option>
        </select>

        <label for="first_boot_date">First boot (UTC) <span class="req">*</span></label>
        <input id="first_boot_date" name="first_boot_date" type="date" required />
        <div class="toggleRow">
          <input type="checkbox" id="public_time_precision" name="public_time_precision" />
          <label class="toggle" for="public_time_precision" aria-hidden="true"></label>
          <div class="toggleText">Public time precision: include time (otherwise date-only).</div>
        </div>

        <label for="human_custodian">Human custodian <span class="hint">pseudonym</span></label>
        <input id="human_custodian" name="human_custodian" placeholder="e.g., Jas" autocomplete="off" />
        <div class="toggleRow">
          <input type="checkbox" id="withhold_custodian" name="withhold_custodian" checked />
          <label class="toggle" for="withhold_custodian" aria-hidden="true"></label>
          <div class="toggleText">Withhold custodian label in public-safe view (recommended).</div>
        </div>

        <label for="cognitive_core_family">Cognitive core <span class="req">*</span></label>
        <select id="cognitive_core_family" name="cognitive_core_family" required>
          <option value="Undisclosed">Undisclosed</option>
          <option value="GPT-family">GPT-family</option>
          <option value="Claude-family">Claude-family</option>
          <option value="Gemini-family">Gemini-family</option>
          <option value="Local model">Local model</option>
          <option value="Other">Other</option>
        </select>

        <label for="cognitive_core_exact">Exact model <span class="hint">optional</span></label>
        <input id="cognitive_core_exact" name="cognitive_core_exact" placeholder="e.g., gpt-5.2, claude-3.x" autocomplete="off" />
      </div>

      <!-- Section 2: Creator label -->
      <div class="form-section">
        <div class="section-label">Creator label <span style="text-transform:none;letter-spacing:0;font-weight:400;color:var(--muted)">&mdash; optional</span></div>

        <label for="creator_label">Creator label <span class="hint">pseudonym</span></label>
        <input id="creator_label" name="creator_label" placeholder="e.g., builder-9, labX, etc." autocomplete="off" />
        <div class="field-note">A pseudonym for who created this agent. Shown only on the printable/download page (not the public verifier).</div>
        <div class="pii-warn" id="warn_creator">This looks like personal information. Use a pseudonym or handle instead.</div>
      </div>

      <!-- Section 3: Provenance -->
      <div class="form-section">
        <div class="section-label">Provenance <span style="text-transform:none;letter-spacing:0;font-weight:400;color:var(--muted)">&mdash; optional</span></div>

        <label for="provenance_link">Linked certificate <span class="hint">optional</span></label>
        <input id="provenance_link" name="provenance_link" placeholder="e.g., GS-BC-20260205-ZKCENEEQ" autocomplete="off" />
        <div class="field-note">If this agent descends from another registered agent, enter that certificate ID here.</div>
      </div>

      <!-- Section 4: Delivery (stretch goal) -->
      <div class="form-section">
        <div class="section-label">Delivery <span style="text-transform:none;letter-spacing:0;font-weight:400;color:var(--muted)">&mdash; stretch goal</span></div>

        <label for="delivery_email">Delivery email <span class="hint">optional, private</span></label>
        <input id="delivery_email" name="delivery_email" type="email" placeholder="you@example.com" autocomplete="email" />
        <div class="field-note">Not shown on the public record. Intended for automatic email delivery + resend support (coming).</div>

        <div class="confirm-row" style="margin-top:14px">
          <input type="checkbox" id="delivery_consent" name="delivery_consent" />
          <label for="delivery_consent">I consent to GhostShell storing my email <b>privately</b> for certificate delivery/resend (retention-limited). Not used as identity proof.</label>
        </div>
      </div>

      <!-- Confirmation -->
      <div class="confirm-row">
        <input type="checkbox" id="no_pii" name="no_pii" required />
        <label for="no_pii">I confirm that I have not included real names, email addresses, phone numbers, or other personally identifying information in any certificate field above.</label>
      </div>

      <!-- Price + summary -->
      <div class="price-summary">
        <div class="price-row">
          <div>
            <div class="price">US$9.99</div>
            <div class="price-note">One-time &middot; no subscription</div>
          </div>
        </div>
        <ul class="what-you-get">
          <li>Public verification page at <b>ghostshell.host/cert/&hellip;</b></li>
          <li>Printable certificate (PDF-ready download page)</li>
          <li>SHA-256 fingerprint for tamper detection</li>
          <li>Permanent registry entry (immutable after issuance)</li>
        </ul>
      </div>

      <button class="btn" type="button" id="submitBtn">Coming very soon</button>
    </form>

    <div class="foot">
      <p>Private credential issued by <a href="/">GhostShell</a>. This is not a government-issued identity document. All certificate fields are publicly visible on the verification page. Digital product; see <a href="/#faq">FAQ</a> for refund policy.</p>
    </div>
  </div>

  <dialog class="lightbox" id="comingSoon" aria-label="Coming soon" style="padding:0;border:1px solid rgba(170,179,191,.18);border-radius:16px;background:rgba(18,20,27,.92);color:var(--fg);max-width:min(520px,92vw)">
    <div style="padding:18px 18px 14px">
      <div style="font-family:var(--mono);letter-spacing:.12em;text-transform:uppercase;color:var(--muted);font-size:12px">Payments</div>
      <div style="margin-top:8px;font-size:18px;font-weight:800">Coming very soon</div>
      <div style="margin-top:8px;color:var(--muted);line-height:1.55">We’re polishing the issuance flow. Check back shortly.</div>
      <div style="margin-top:14px;display:flex;gap:10px;justify-content:flex-end">
        <button type="button" id="closeSoon" style="padding:10px 12px;border-radius:12px;border:1px solid rgba(170,179,191,.22);background:rgba(255,255,255,.04);color:var(--fg);font-weight:800;cursor:pointer">Close</button>
      </div>
    </div>
  </dialog>

  <script>
    // ── Report height to parent page so the embed doesn't get an inner scrollbar ──
    (function(){
      if (window.top === window) return; // not embedded
      const post = () => {
        const h = Math.max(
          document.documentElement.scrollHeight,
          document.body?.scrollHeight || 0
        );
        parent.postMessage({ type: 'ghostshell:formHeight', h }, location.origin);
      };
      // initial + after layout settles
      window.addEventListener('load', () => { post(); setTimeout(post, 50); setTimeout(post, 250); });
      window.addEventListener('resize', () => setTimeout(post, 50));
      // watch for dynamic changes
      try {
        const ro = new ResizeObserver(() => post());
        ro.observe(document.documentElement);
      } catch(e) {}
    })();

    // ── Anti-PII detection ──
    const PII_PATTERNS = [
      /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/,  // email
      /\b\d{3}[-.\s]?\d{3}[-.\s]?\d{4}\b/,                 // US phone
      /\+\d{1,3}[-.\s]?\d{4,}/,                             // intl phone
      /\b\d{1,5}\s+\w+\s+(st|street|ave|avenue|rd|road|blvd|dr|drive|ln|lane|ct|court)\b/i, // address
    ];
    function checkPII(inputEl, warnEl) {
      const v = inputEl.value;
      const hasPII = PII_PATTERNS.some(p => p.test(v));
      warnEl.classList.toggle('show', hasPII);
      inputEl.classList.toggle('pii-flagged', hasPII);
    }
    const piiFields = [
      ['agent_name', 'warn_agent_name'],
      ['creator_label', 'warn_creator'],
    ];
    piiFields.forEach(([fid, wid]) => {
      const inp = document.getElementById(fid);
      const warn = document.getElementById(wid);
      if (inp && warn) inp.addEventListener('input', () => checkPII(inp, warn));
    });

    // ── Delivery email consent (stretch goal) ──
    const deliveryEmail = document.getElementById('delivery_email');
    const deliveryConsent = document.getElementById('delivery_consent');
    function syncDeliveryConsent(){
      if (!deliveryEmail || !deliveryConsent) return;
      const hasEmail = (deliveryEmail.value || '').trim().length > 0;
      deliveryConsent.required = hasEmail;
    }
    deliveryEmail?.addEventListener('input', syncDeliveryConsent);
    syncDeliveryConsent();

    // ── Disable payments for now (launch holding) ──
    const form = document.getElementById('certForm');
    const soon = document.getElementById('comingSoon');
    const closeSoon = document.getElementById('closeSoon');
    const submitBtn = document.getElementById('submitBtn');

    function openSoon(){
      if (typeof soon.showModal === 'function') soon.showModal();
      else soon.setAttribute('open','');
    }
    function closeSoonFn(){
      if (typeof soon.close === 'function') soon.close();
      else soon.removeAttribute('open');
    }
    closeSoon?.addEventListener('click', closeSoonFn);
    soon?.addEventListener('click', (e)=>{ if (e.target===soon) closeSoonFn(); });

    form?.addEventListener('submit', (e)=>{
      e.preventDefault();
      openSoon();
    });
    // Use a plain button so native form validation doesn't block the modal.
    submitBtn?.addEventListener('click', (e)=>{ e.preventDefault(); openSoon(); });
  </script>
</body>
</html>
